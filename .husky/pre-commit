#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Check if we're in a Java project
if [ -f "pom.xml" ]; then
    echo "â˜• Java project detected, running Maven checks..."
    
    # Run Maven validate
    echo "ğŸ“‹ Validating Maven configuration..."
    mvn validate
    
    if [ $? -ne 0 ]; then
        echo "âŒ Maven validation failed. Commit cancelled."
        exit 1
    fi
    
    # Run Checkstyle
    echo "ğŸ” Running Checkstyle..."
    mvn checkstyle:check
    
    if [ $? -ne 0 ]; then
        echo "âŒ Checkstyle failed. Commit cancelled."
        exit 1
    fi
    
    # Run tests
    echo "ğŸ§ª Running tests..."
    mvn test
    
    if [ $? -ne 0 ]; then
        echo "âŒ Tests failed. Commit cancelled."
        exit 1
    fi
    
    echo "âœ… All pre-commit checks passed!"
else
    echo "ğŸ“ Non-Java project, running basic checks..."
    
    # Check for TODO/FIXME comments
    if grep -r "TODO\|FIXME\|XXX" --include="*.java" --include="*.js" --include="*.ts" --include="*.jsx" --include="*.tsx" .; then
        echo "âš ï¸  TODO/FIXME/XXX comments found. Consider addressing them."
    fi
    
    # Check for console.log statements
    if grep -r "console\.log" --include="*.js" --include="*.ts" --include="*.jsx" --include="*.tsx" .; then
        echo "âš ï¸  console.log statements found. Consider using a logger instead."
    fi
    
    # Check for debugger statements
    if grep -r "debugger" --include="*.js" --include="*.ts" --include="*.jsx" --include="*.tsx" .; then
        echo "âŒ debugger statements found. Commit cancelled."
        exit 1
    fi
    
    echo "âœ… Basic pre-commit checks passed!"
fi

# Run Prettier if available
if command -v prettier &> /dev/null; then
    echo "ğŸ¨ Running Prettier..."
    prettier --check .
    
    if [ $? -ne 0 ]; then
        echo "âŒ Prettier formatting failed. Commit cancelled."
        exit 1
    fi
fi

# Run ESLint if available
if command -v eslint &> /dev/null; then
    echo "ğŸ” Running ESLint..."
    eslint .
    
    if [ $? -ne 0 ]; then
        echo "âŒ ESLint failed. Commit cancelled."
        exit 1
    fi
fi

echo "ğŸ‰ All pre-commit checks passed! Proceeding with commit..."

